<ion-content class="ion-no-padding">
  
  <ion-grid style="height: 100vh;">
    <ion-row style="height: 100%;">
      
    
      <ion-col size="auto" class="menu-lateral">
        
         <div class="ion-text-center ion-padding-vertical">
          <img src="assets\icon\SouFitLogo.png" alt="Logo" style="width: 32; height: 32;">
        </div>

        <div class="boton-menu" (click)="volverHome()">
          <ion-icon name="home-outline"></ion-icon>
          <p>Inicio</p>
        </div>

        <div class="boton-menu">
          <ion-icon name="search-outline"></ion-icon>
          <p>Buscar</p>
        </div>

        <div class="boton-menu" (click)="rutinas()">
          <ion-icon name="barbell-outline"></ion-icon>
          <p>Rutinas</p>
        </div>

        <div class="boton-menu activo">
          <ion-icon name="chatbubbles-outline"></ion-icon>
          <p>Mensajes</p>
        </div>

        <div class="boton-menu" (click)="perfil()">
          <ion-icon name="person-outline"></ion-icon>
          <p>Perfil</p>
        </div>

      </ion-col>


      <ion-col size="4" class="lista-chats">
        
        <div class="header-chats">
          <h1>{{ usuarioActual?.nombre || 'Usuario' }}</h1>
          <p>EN LINEA</p>
        </div>

        <div class="chats-contenedor">
          
          <!-- Lista dinámica de chats -->
          <div 
            *ngFor="let chat of chats" 
            class="chat-item" 
            [class.activo]="chatActivo?.id_usuario === chat.id_usuario"
            (click)="seleccionarChat(chat)">
            <ion-avatar>
              <img [src]="chat.avatar || 'https://ionicframework.com/docs/img/demos/avatar.svg'" [alt]="chat.nombre">
            </ion-avatar>
            <div class="chat-info">
              <h3>{{ chat.nombre }}</h3>
              <p>{{ chat.ultimo_mensaje || 'No hay mensajes' }}</p>
            </div>
            <div class="chat-hora">
              <span>{{ chat.fecha_ultimo_mensaje ? formatearFechaUltimoMensaje(chat.fecha_ultimo_mensaje) : '' }}</span>
            </div>
          </div>

          <!-- Mensaje cuando no hay chats -->
          <div *ngIf="chats.length === 0" class="no-chats">
            <p>No tienes conversaciones aún</p>
            <small>Empieza una nueva conversación</small>
          </div>

        </div>
      </ion-col>

      <ion-col class="chat-conversacion">
        
        <!-- Header de la conversación actual -->
        <div class="header-conversacion" *ngIf="chatActivo">
          <ion-avatar>
            <img [src]="chatActivo.avatar || 'https://ionicframework.com/docs/img/demos/avatar.svg'" [alt]="chatActivo.nombre">
          </ion-avatar>
          <div class="info-contacto">
            <h2>{{ chatActivo.nombre }}</h2>
            <p *ngIf="chatActivo.en_linea" class="estado-online">En línea</p>
          </div>
        </div>

   
        <!-- Área de mensajes -->
        <div class="mensajes-area" #mensajesContainer *ngIf="chatActivo">
          
          <!-- Lista dinámica de mensajes -->
          <div 
            *ngFor="let mensaje of mensajes" 
            class="mensaje"
            [class.enviado]="esMensajePropio(mensaje)"
            [class.recibido]="!esMensajePropio(mensaje)">
            <div class="mensaje-contenido">
              <p>{{ mensaje.contenido }}</p>
              <small class="mensaje-hora">{{ formatearHora(mensaje.fecha_envio!) }}</small>
            </div>
          </div>

          <!-- Mensaje cuando no hay mensajes en el chat actual -->
          <div *ngIf="mensajes.length === 0" class="no-mensajes">
            <p>No hay mensajes en esta conversación</p>
            <small>Escribe algo para empezar</small>
          </div>

        </div>

        <!-- Mensaje cuando no hay chat seleccionado -->
        <div *ngIf="!chatActivo" class="no-chat-seleccionado">
          <ion-icon name="chatbubbles-outline"></ion-icon>
          <h3>Selecciona una conversación</h3>
          <p>Elige una conversación de la lista para empezar a chatear</p>
        </div>

        <!-- Área de escritura -->
        <div class="area-escribir" *ngIf="chatActivo">
          <div class="input-mensaje">
            <input 
              type="text" 
              placeholder="Escribe un mensaje..."
              [(ngModel)]="nuevoMensaje"
              (keydown)="onEnterPressed($event)"
              #inputMensaje />
            <button class="btn-enviar" (click)="enviarMensaje()" [disabled]="!nuevoMensaje.trim()">
              <ion-icon name="send-outline"></ion-icon>
            </button>
            <button class="btn-micro">
              <ion-icon name="mic-outline"></ion-icon>
            </button>
            <button class="btn-emoji">
              <ion-icon name="happy-outline"></ion-icon>
            </button>
            <button class="btn-archivo">
              <ion-icon name="image-outline"></ion-icon>
            </button>
          </div>
        </div>

      </ion-col>

    </ion-row>
  </ion-grid>
</ion-content>